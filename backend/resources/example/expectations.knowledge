@ENV.SCREWDRIVER.1 = {};
@ENV.HUMAN.1 = {};


@EXE.EXAMPLE-CAPABILITY = {
    IS-A @EXE.CAPABILITY;
    MP "example_capability";
};

@SELF.VERBAL-EFFECTOR.1 = {
    IS-A @EXE.VERBAL-EFFECTOR;
    HAS-CAPABILITY @EXE.EXAMPLE-CAPABILITY;
    STATUS "FREE";
};

@SELF.ROBOT.1 += {
    PRIORITY_WEIGHT 1.5;
    RESOURCES_WEIGHT 0.25;
    HAS-EFFECTOR @SELF.VERBAL-EFFECTOR.1;
};

DEFINE greet($var) AS TEMPLATE
    TYPE VERBAL
    REQUIRES @EXE.EXAMPLE-CAPABILITY
    ROOT @OUT.SPEECH-ACT.1
    INCLUDE

    @OUT.SPEECH-ACT.1 = {
        AGENT @SELF.ROBOT.1;
        THEME @OUT.GREET.1;
    };

    @OUT.GREET.1 = {
        AGENT @SELF.ROBOT.1;
        THEME @ENV.HUMAN.1;
    };
;

REGISTER MP backend.resources.example.ExampleMP.ExampleCapability AS example_capability;

DEFINE GOAL-WITH-EXPECTATION($tmr)
    AS GOAL
    IN EXE
    PRIORITY 0.5
    RESOURCES 0.5
    PLAN (plan with expectation)
        SELECT DEFAULT
        STEP
            DO EXPECT EXISTS (@ ISA @ONT.PHYSICAL-EVENT AND AGENT=@ENV.HUMAN.1 AND THEME=@ENV.SCREWDRIVER.1)
        STEP
            DO OUTPUT greet() BY SELF
    WHEN EXECUTED THEN satisfied
;

ADD TRIGGER TO @SELF.ROBOT.1 INSTANTIATE @EXE.GOAL-WITH-EXPECTATION WHEN (@ ISA @EXE.TMR AND STATUS #XMR.InputStatus.RECEIVED and TYPE = #XMR.Type.LANGUAGE);